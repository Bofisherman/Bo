{% extends 'base.html' %}
{% block title %}Admin Dashboard - BO Fisherman{% endblock %}

{% block content %}
<div class="container">
  <h1 class="page-title">ðŸ“Š Admin Dashboard</h1>

  {% for cat in categories %}
    <div class="card">
      <!-- Category Edit Form -->
      <form method="POST" action="{{ url_for('main.edit_category') }}" class="form-grid" style="margin-bottom: 1rem;">
        <input type="hidden" name="category_id" value="{{ cat['id'] }}">
        <div style="display: flex; gap: 1rem; align-items: center;">
          <input type="text" name="name" value="{{ cat['name'] }}" required style="flex:1;">
          <input type="text" name="icon" value="{{ cat['icon'] or '' }}" style="width: 80px;">
        </div>
        <input type="text" name="description" value="{{ cat['description'] or '' }}" placeholder="Description">
        <button type="submit" class="btn-secondary">ðŸ’¾ Update Category</button>
      </form>

      <!-- Separate Delete Category Form -->
      <form method="POST" action="{{ url_for('main.delete_category') }}" onsubmit="return confirm('Delete this category and all its lessons?');" style="margin-bottom: 2rem;">
        <input type="hidden" name="category_id" value="{{ cat['id'] }}">
        <button type="submit" class="btn-danger">ðŸ—‘ Delete Category</button>
      </form>

      <!-- Lesson Upload Form -->
      <form method="POST" action="{{ url_for('main.upload_lesson') }}" enctype="multipart/form-data" class="form-grid">
        <input type="hidden" name="category" value="{{ cat['id'] }}">

        <div class="form-field">
          <label>Lesson Title:</label>
          <input type="text" name="title" required>
        </div>

        <div class="form-field">
          <label>Description:</label>
          <input type="text" name="description" required>
        </div>

        <div class="form-field">
          <label>Media Type:</label>
          <select name="media_type" required>
            <option value="video">Video</option>
            <option value="image">Image</option>
          </select>
        </div>

        <div class="form-field">
          <label>Upload File:</label>
          <input type="file" name="media" accept="video/*,image/*" required>
        </div>

        <button type="submit" class="btn-primary">Upload Lesson</button>
      </form>

      <!-- Existing Lessons -->
      {% if category_lessons[cat['id']] %}
        <div class="lesson-grid">
          {% for lesson in category_lessons[cat['id']] %}
            <div class="lesson-card">
              <!-- Lesson Edit Form -->
              <form method="POST" action="{{ url_for('main.edit_lesson') }}" enctype="multipart/form-data" class="form-grid">
                <input type="hidden" name="lesson_id" value="{{ lesson['id'] }}">

                <input type="text" name="title" value="{{ lesson['title'] }}" required>
                <input type="text" name="description" value="{{ lesson['description'] }}" required>

                <select name="media_type">
                  <option value="video" {% if lesson['media_type'] == 'video' %}selected{% endif %}>Video</option>
                  <option value="image" {% if lesson['media_type'] == 'image' %}selected{% endif %}>Image</option>
                </select>

                <label>Replace Media (optional):</label>
                <input type="file" name="media" accept="video/*,image/*">

                {% if lesson['media_type'] == 'video' %}
                  <video controls width="100%">
                    <source src="{{ lesson['media_url'] }}" type="video/mp4">
                  </video>
                {% else %}
                  <img src="{{ lesson['media_url'] }}" alt="{{ lesson['title'] }}" style="width:100%; border-radius: 8px;">
                {% endif %}

                <button type="submit" class="btn-secondary">ðŸ’¾ Update Lesson</button>
              </form>

              <!-- Separate Delete Lesson Form -->
              <form method="POST" action="{{ url_for('main.delete_lesson') }}" onsubmit="return confirm('Are you sure you want to delete this lesson?');" style="margin-top: 0.5rem;">
                <input type="hidden" name="lesson_id" value="{{ lesson['id'] }}">
                <button type="submit" class="btn-danger">ðŸ—‘ Delete Lesson</button>
              </form>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p><em>No lessons uploaded yet in this category.</em></p>
      {% endif %}
    </div>
  {% endfor %}
</div>
{% endblock %}
